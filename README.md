# myRPC UNIX

---

Проект, который содержит демон myRPC-server , клиент myRPC-client, библиотеку mysyslog и Bash скрипты. Также этот проект собирает .deb пакеты и формирует из них репозиторий. К этому репозиторию подключается клиент и заходит, скачивает пакеты и общается с сервером.

### Клиент myRPC-client

Пользователь при помощи аргументов командной строки задает параметры подключения к серверу, тип сокета и команду. Вывод помощи в консоли, вывод ошибки если подключение не удалось.

### Сервер myRPC-server

Получает из конфигурационного файла /etc/myRPC/myRPC.conf номер порта и тип сокета, получает через механизм сокетов строку в выбранном формате с именем пользователя и командой разбирает строку, получает из нее имя пользователя и команду, проверяет в конфигурационном файле /etc/myRPC/users.conf есть ли этот пользователь. Использует mysyslog чтобы писать логи в  /tmp/ .

### Библиотека mysyslog

Логирует действия и команды во временные файлы. 
Успешные действия /tmp/myRPC_XXXXXX.stdout 
Неудачные действия /tmp/myRPC_XXXXXX.stderr

---

## Настройки

Проект имеет настраиваемые конфигурационные файлы: myRPC.conf , myRPC.server. Файлы systemd: myRPC-server.service

### myRPC.conf

```
port = <Укажите номер порта>
socket_type = <stream (TCP),dgram (UDP)>
```

Если не настроить то сервер использует по умолчанию порт 25565 и тип сокета stream!

По завершении настройки в /src/config/myRPC.conf . Скопируйте и замените этот файл в /etc/myRPC/myRPC.conf

   ```bash
   cp -f <путь/до/src/config/myRPC.conf> </etc/myRPC/>
   ```
Если нету папки. Создайте её!

   ```bash
   mkdir /etc/myRPC
   ```

### users.conf

```
<Пользователь 1>
<Пользователь 2>
<Пользователь 3>
```

Если ваш пользователь не будет в этом файле то вам будет отказано в доступе к серверу и он выведет ошибку в формате JSON.
По завершению настройки поступаем также как и в копировании myRPC.conf , только у нас будет users.conf


При вводе make clean. Удаляет лишние файлы myRPC_XXXXXX в /tmp/

## Требования

- gcc (Компилятор языка Си)
- python (Сетевой репозиторий)
- git (Клонирование репозитория)
- make (Сборка проекта)
- fakeroot (создание .deb пакетов)

## Сборка проекта

Для сборки проекта используйте Makefile

Введите:

1. Клонируйте репозиторий:
   ```bash
   git clone <ссылка на этот проект>
   ```
2. Перейдите в директорию с проектом:
   ```bash
    cd ~/myRPC/
   ```
3. Соберите проект:
   ```bash
    make all
   ```
4. Соберите .deb пакеты:
   ```bash
    make deb
   ```
5. Создайте репозиторий .deb пакетов:
   ```bash
    make repo
   ```

6. Создайте общий репозиторий .deb пакетов (mysyslog должен быть собран!):
   ```bash
    make repository 
   ```
   
## Сетевой репозиторий 

Сетевой репозиторий позволяет подключаться клиенту по локальной сети и устанавливать нужные deb. пакеты.

Для того чтобы запустить репозиторий перейдите:

   ```bash
    cd repo
   ```
Для запуска сетевого репозитория используем python3. Простейшая утилита для создания HTTP-серверов.
Для запуска вводим команду:

   ```bash
    python3 -m http.server <Порт>
   ```

На клиенте создаем файл:

   ```bash
   echo "deb [trusted=yes] http://<айпи или домен сервера:порт> ./" | sudo tee /etc/apt/sources.list.d/myrpc.list
   ```

Затем: 

   ```bash
   sudo apt update
sudo apt install myRPC-client myRPC-server mysyslog

   ```

Можно скачать по ссылке: http://localhost:8000/Packages.gz

## Запуск проекта

Если все готово то можно запускать проект:

## myRPC-server

Он должен автоматически установиться при скачивании .deb пакета.
Если этого не произошло значит попробуйте вручную.

Узнаем статус демона:
   ```bash
   systemctl status myRPC-server
   ```
Перезапускаем демоны:
   ```bash
   systemctl daemon-reload
   ```
Перезапускаем сервер:
   ```bash
   systemctl restart myRPC-server
   ```

Если вы изменили myRPC.conf или users.conf в папке /etc/myRPC/

Значит нужно перезагрузить сервер.
   ```bash
   systemctl restart myRPC-server
   ```

## myRPC-client

С клиентом все куда проще.
Его можно запускать через папку bin в myRPC или если вы установили .deb пакет значит myRPC-client. 
Запуск через /bin/myRPC-client:
   ```bash
   ./bin/myRPC-client <ключи>
   ```
Ключи:

-c , команда
-h , айпи
-p , порт как в /etc/myRPC/myRPC.conf
-d dgram / -s stream сокет как /etc/myRPC/myRPC.conf

Пример рабочей команды:
   ```bash
   myRPC-client -c "echo Привет сервер" -h 127.0.0.1 -p 4040 -d
   ```
Если ваш пользователь не в списке то сервер пошлем вам код 1 и запрос отклонён.

Если вы все сделали правильно значит вам сервер ответит!
